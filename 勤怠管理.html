<!DOCTYPE html>
<html>

<head>
    <base target="_top">
</head>
<style>
    body {
        margin: 25px;
    }

    .loading {
        display: none;
        text-align: center;
        padding: 20px;
    }

    .result {
        display: none;
    }

    .radioWhoExec {
        margin: 10px;
    }

    #spreadsheetID {
        width: 920px;
    }
</style>

<body>
    <div class="loading" id="loading">
        <div class="mdl-spinner mdl-js-spinner is-active"></div>
        <p>処理中です...</p>
    </div>
    <div class="result" id="result">
        <p>処理結果:</p>
        <p id="output"></p>
    </div>

    <div class="radioWhoExec">textareaにコピペするのは誰か？(「自分」は誰か？)<br>
        <label><input type="radio" name="radioGroup" value="0"> 吉村</label><br>
        <label><input type="radio" name="radioGroup" value="1"> 服部</label><br>
        <label><input type="radio" name="radioGroup" value="2"> 相田</label><br>
        <label><input type="radio" name="radioGroup" value="3"> 斎藤</label><br>
        <label><input type="radio" name="radioGroup" value="4"> 佐藤</label><br>
        <label><input type="radio" name="radioGroup" value="5"> 周</label><br>
        <label><input type="radio" name="radioGroup" value="6"> 北村</label><br>
        <label><input type="radio" name="radioGroup" value="7"> 葵</label>
    </div>
    処理開始日時<input id="execDate" name="date" type="date" value="yyyy-mm-dd" />
    <br>
    <textarea id="myTextarea" rows="15" cols="80"></textarea>
    <br>
    <button onclick="sendData()">送信</button>
    <br>
    <input type="text" id="spreadsheetID" name="spreadsheetID" value=<?=spreadSheet ?>>
    <button onclick="openSpreadsheet();">スプレッドシートを別タブで開く</button>
    <br>
    <a href="https://docs.google.com/spreadsheets/d/1CQAwp87w_WYyJxCEWSJvcUT8H_-zftKRgERLarko3sQ/edit?usp=sharing"
        target="_blank">bot化歴代シートを別タブで開く</a>

    <script>
        $('input[type=date]').on('focus', function () {
            $('#placeholder').hide();
        }).on('blur', function () {
            var val = $(this).val();
            if (!val) {
                $('#placeholder').show();
            }
        });

        function sendData() {
            const textareaValue = document.getElementById('myTextarea').value;
            const execDate = document.getElementById('execDate').value;
            const operator = document.querySelector('input[name="radioGroup"]:checked').value;
            const spreadsheetFromFront = document.getElementById('spreadsheetID').value;

            document.getElementById('loading').style.display = 'block';

            google.script.run
                .withSuccessHandler(onSuccess)
                .withFailureHandler(onFailure)
                .processData(textareaValue, execDate, operator, spreadsheetFromFront);
        }

        function onSuccess(output) {
            document.getElementById('result').style.display = 'block';
            document.getElementById('result').innerText = "保存しました";

            document.getElementById('loading').style.display = 'none';
        }

        function onFailure(error) {
            document.getElementById('result').innerText = 'エラーが発生しました: ' + error.message;
            document.getElementById('result').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
        }

        function openSpreadsheet() {
            let spreadsheetUrl = document.getElementById('spreadsheetID').value;
            const link = document.createElement("a");
            link.href = spreadsheetUrl;
            link.target = "_blank";
            link.style.display = "none"; // <a>タグを非表示にする
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link); // 不要になったら削除
        }
    </script>
</body>

</html>